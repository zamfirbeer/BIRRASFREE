<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Colecci√≥n de Cervezas</title>
  <!-- React + ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <!-- Babel in-browser -->
  <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-amber-50">

<div id="root"></div>

<!-- Firebase config y funciones -->
<script type="text/babel">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import {
  getFirestore,
  collection,
  getDocs,
  addDoc,
  deleteDoc,
  doc,
  updateDoc
} from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyA8HtouyDiMEr7wYgIVjP-tNog9QAp5tZU",
  authDomain: "beerfree-e7dbb.firebaseapp.com",
  projectId: "beerfree-e7dbb",
  storageBucket: "beerfree-e7dbb.firebasestorage.app",
  messagingSenderId: "990167849390",
  appId: "1:990167849390:web:d0dc8fb5d263d07273503f"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

// Hacemos Firestore global para simplificar
window.db = db;
window.fb = { collection, getDocs, addDoc, deleteDoc, doc, updateDoc };
</script>

<!-- React App -->
<script type="text/babel">
const { useState, useEffect } = React;

// Iconos
const PlusIcon = () => <span>‚ûï</span>;
const SearchIcon = () => <span>üîç</span>;
const DownloadIcon = () => <span>‚¨áÔ∏è</span>;
const EditIcon = () => <span>‚úèÔ∏è</span>;
const TrashIcon = () => <span>üóëÔ∏è</span>;

function BeerDatabase() {
  const [beers, setBeers] = useState([]);
  const [showForm, setShowForm] = useState(false);
  const [editingId, setEditingId] = useState(null);
  const [sqlQuery, setSqlQuery] = useState('');
  const [filteredBeers, setFilteredBeers] = useState([]);
  const [formData, setFormData] = useState({
    nombre: '',
    tipo: '',
    nacionalidad: '',
    color: '',
    observaciones: '',
    puntuacion: '',
    imagen: ''
  });

  // Cargar cervezas desde Firestore
  useEffect(() => {
    async function loadBeers() {
      const snapshot = await window.fb.getDocs(window.fb.collection(window.db, "beers"));
      setBeers(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));
    }
    loadBeers();
  }, []);

  useEffect(() => setFilteredBeers(beers), [beers]);

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setFormData(prev => ({ ...prev, [name]: value }));
  };

  const handleImageChange = (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onloadend = () => setFormData(prev => ({ ...prev, imagen: reader.result }));
      reader.readAsDataURL(file);
    }
  };

  const handleSubmit = async () => {
    if (!formData.nombre || !formData.tipo || !formData.nacionalidad || !formData.color || !formData.puntuacion) {
      alert('Por favor completa todos los campos obligatorios');
      return;
    }

    if (editingId) {
      await window.fb.updateDoc(window.fb.doc(window.db, "beers", editingId), formData);
      setEditingId(null);
    } else {
      await window.fb.addDoc(window.fb.collection(window.db, "beers"), formData);
    }

    // Recargar cervezas
    const snapshot = await window.fb.getDocs(window.fb.collection(window.db, "beers"));
    setBeers(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));

    resetForm();
  };

  const resetForm = () => {
    setFormData({ nombre:'', tipo:'', nacionalidad:'', color:'', observaciones:'', puntuacion:'', imagen:'' });
    setShowForm(false);
  };

  const handleEdit = (beer) => {
    const { id, ...data } = beer;
    setFormData(data);
    setEditingId(id);
    setShowForm(true);
  };

  const handleDelete = async (id) => {
    if (confirm('¬øEliminar esta cerveza?')) {
      await window.fb.deleteDoc(window.fb.doc(window.db, "beers", id));
      setBeers(beers.filter(b => b.id !== id));
    }
  };

  const downloadData = () => {
    const blob = new Blob([JSON.stringify(beers, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'mis_cervezas.json'; a.click(); URL.revokeObjectURL(url);
  };

  return (
    <div className="max-w-7xl mx-auto p-4">
      <div className="flex justify-between items-center mb-4">
        <h1 className="text-3xl font-bold text-amber-800">üç∫ Mi Colecci√≥n de Cervezas</h1>
        <div className="flex gap-2">
          <button onClick={() => setShowForm(!showForm)} className="bg-amber-600 text-white px-4 py-2 rounded-lg">
            <PlusIcon /> {showForm ? 'Cancelar' : 'Agregar'}
          </button>
          <button onClick={downloadData} className="bg-green-600 text-white px-4 py-2 rounded-lg">
            <DownloadIcon /> Exportar
          </button>
        </div>
      </div>

      {showForm && (
        <div className="bg-amber-50 p-4 rounded mb-4">
          <input type="text" name="nombre" value={formData.nombre} onChange={handleInputChange} placeholder="Nombre *" className="border p-2 rounded mb-2 w-full"/>
          <input type="text" name="tipo" value={formData.tipo} onChange={handleInputChange} placeholder="Tipo *" className="border p-2 rounded mb-2 w-full"/>
          <input type="text" name="nacionalidad" value={formData.nacionalidad} onChange={handleInputChange} placeholder="Nacionalidad *" className="border p-2 rounded mb-2 w-full"/>
          <input type="text" name="color" value={formData.color} onChange={handleInputChange} placeholder="Color *" className="border p-2 rounded mb-2 w-full"/>
          <input type="number" name="puntuacion" value={formData.puntuacion} onChange={handleInputChange} placeholder="Puntuaci√≥n *" className="border p-2 rounded mb-2 w-full"/>
          <textarea name="observaciones" value={formData.observaciones} onChange={handleInputChange} placeholder="Observaciones" className="border p-2 rounded mb-2 w-full"/>
          <input type="file" onChange={handleImageChange} className="mb-2"/>
          <button onClick={handleSubmit} className="bg-amber-700 text-white px-4 py-2 rounded">{editingId ? 'Actualizar' : 'Guardar'}</button>
        </div>
      )}

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
        {beers.map(beer => (
          <div key={beer.id} className="bg-white p-4 rounded shadow">
            {beer.imagen && <img src={beer.imagen} className="w-full h-48 object-contain mb-2"/>}
            <h2 className="font-bold text-lg">{beer.nombre}</h2>
            <p>Tipo: {beer.tipo}</p>
            <p>Nacionalidad: {beer.nacionalidad}</p>
            <p>Color: {beer.color}</p>
            <p>Puntuaci√≥n: {beer.puntuacion}/10</p>
            {beer.observaciones && <p className="italic">{beer.observaciones}</p>}
            <div className="flex gap-2 mt-2">
              <button onClick={() => handleEdit(beer)} className="bg-blue-500 text-white px-2 py-1 rounded"><EditIcon /> Editar</button>
              <button onClick={() => handleDelete(beer.id)} className="bg-red-500 text-white px-2 py-1 rounded"><TrashIcon /> Eliminar</button>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<BeerDatabase />);
</script>

</body>
</html>
