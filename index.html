<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Colecci√≥n de Cervezas</title>
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    getDocs,
    addDoc,
    deleteDoc,
    doc,
    updateDoc
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBwsQT_uy2djMTEZpcMb451AhXgd5Pn8xk",
    authDomain: "beerfree-e7dbb.firebaseapp.com",
    projectId: "beerfree-e7dbb",
    storageBucket: "beerfree-e7dbb.firebasestorage.app",
    messagingSenderId: "990167849390",
    appId: "1:990167849390:web:d0dc8fb5d263d07273503f"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  // üî• hacemos Firestore global
  window.db = db;
  window.fb = {
    collection,
    getDocs,
    addDoc,
    deleteDoc,
    doc,
    updateDoc
  };
</script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Iconos SVG inline
        const PlusIcon = () => (
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
        );

        const SearchIcon = () => (
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
        );

        const DownloadIcon = () => (
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
            <polyline points="7 10 12 15 17 10"></polyline>
            <line x1="12" y1="15" x2="12" y2="3"></line>
          </svg>
        );

        const EditIcon = () => (
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
            <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
          </svg>
        );

        const TrashIcon = () => (
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <polyline points="3 6 5 6 21 6"></polyline>
            <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
          </svg>
        );

        function BeerDatabase() {
          const [beers, setBeers] = useState([]);
          const [showForm, setShowForm] = useState(false);
          const [editingId, setEditingId] = useState(null);
          const [sqlQuery, setSqlQuery] = useState('');
          const [filteredBeers, setFilteredBeers] = useState([]);
          const [formData, setFormData] = useState({
            nombre: '',
            tipo: '',
            nacionalidad: '',
            color: '',
            observaciones: '',
            puntuacion: '',
            imagen: ''
          });

          useEffect(() => {
  const loadBeers = async () => {
    const snapshot = await window.fb.getDocs(
      window.fb.collection(window.db, "beers")
    );

    const data = snapshot.docs.map(d => ({
      id: d.id,
      ...d.data()
    }));

    setBeers(data);
  };

  loadBeers();
}, []);

          useEffect(() => {
  setFilteredBeers(beers);
}, [beers]);
          const handleInputChange = (e) => {
            const { name, value } = e.target;
            setFormData(prev => ({ ...prev, [name]: value }));
          };

          const handleImageChange = (e) => {
            const file = e.target.files[0];
            if (file) {
              const reader = new FileReader();
              reader.onloadend = () => {
                setFormData(prev => ({ ...prev, imagen: reader.result }));
              };
              reader.readAsDataURL(file);
            }
          };

          const handleSubmit = () => {
            if (!formData.nombre || !formData.tipo || !formData.nacionalidad || !formData.color || !formData.puntuacion) {
              alert('Por favor completa todos los campos obligatorios');
              return;
            }
            
            if (editingId) {
              await window.fb.updateDoc(
  window.fb.doc(window.db, "beers", editingId),
  formData
);

              setEditingId(null);
            } else {
              await window.fb.addDoc(
  window.fb.collection(window.db, "beers"),
  formData
);;
            }
            resetForm();
          };
const snapshot = await window.fb.getDocs(
  window.fb.collection(window.db, "beers")
);
setBeers(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));

          const resetForm = () => {
            setFormData({
              nombre: '',
              tipo: '',
              nacionalidad: '',
              color: '',
              observaciones: '',
              puntuacion: '',
              imagen: ''
            });
            setShowForm(false);
          };

          const handleEdit = (beer) => {
            setFormData(beer);
            setEditingId(beer.id);
            setShowForm(true);
          };

          const handleDelete = (id) => {
            if (confirm('¬øEst√°s seguro de eliminar esta cerveza?')) {
              await window.fb.deleteDoc(
  window.fb.doc(window.db, "beers", id)
);

setBeers(beers.filter(beer => beer.id !== id));

            }
          };

          const executeSQLQuery = () => {
            if (!sqlQuery.trim()) {
              setFilteredBeers(beers);
              return;
            }

            const query = sqlQuery.toLowerCase().trim();
            
            try {
              let result = [...beers];

              if (query.includes('where')) {
                const whereClause = query.split('where')[1].split('order by')[0].trim();
                
                result = beers.filter(beer => {
                  const conditions = whereClause.split('and').map(c => c.trim());
                  
                  return conditions.every(condition => {
                    const likeMatch = condition.match(/(\w+)\s+like\s+['"]%(.+)%['"]/i);
                    const equalMatch = condition.match(/(\w+)\s*=\s*['"](.+)['"]/i);
                    const gtMatch = condition.match(/(\w+)\s*>\s*(\d+\.?\d*)/i);
                    const ltMatch = condition.match(/(\w+)\s*<\s*(\d+\.?\d*)/i);
                    
                    if (likeMatch) {
                      const [, field, value] = likeMatch;
                      return beer[field]?.toLowerCase().includes(value.toLowerCase());
                    } else if (equalMatch) {
                      const [, field, value] = equalMatch;
                      return beer[field]?.toLowerCase() === value.toLowerCase();
                    } else if (gtMatch) {
                      const [, field, value] = gtMatch;
                      return parseFloat(beer[field]) > parseFloat(value);
                    } else if (ltMatch) {
                      const [, field, value] = ltMatch;
                      return parseFloat(beer[field]) < parseFloat(value);
                    }
                    return true;
                  });
                });
              }

              if (query.includes('order by')) {
                const orderClause = query.split('order by')[1].trim();
                const [field, direction] = orderClause.split(/\s+/);
                const isDesc = direction?.toLowerCase() === 'desc';
                
                result.sort((a, b) => {
                  const aVal = a[field] || '';
                  const bVal = b[field] || '';
                  
                  if (!isNaN(aVal) && !isNaN(bVal)) {
                    return isDesc ? bVal - aVal : aVal - bVal;
                  }
                  
                  return isDesc 
                    ? bVal.toString().localeCompare(aVal.toString())
                    : aVal.toString().localeCompare(bVal.toString());
                });
              }

              setFilteredBeers(result);
            } catch (error) {
              alert('Error en la consulta SQL. Verifica la sintaxis.');
            }
          };

          const downloadData = () => {
            const dataStr = JSON.stringify(beers, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'mis_cervezas.json';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
          };

          return (
            <div className="min-h-screen bg-amber-50 p-4">
              <div className="max-w-7xl mx-auto">
                <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                  <div className="flex justify-between items-center mb-6 flex-wrap gap-4">
                    <h1 className="text-3xl font-bold text-amber-800">üç∫ Mi Colecci√≥n de Cervezas</h1>
                    <div className="flex gap-2">
                      <button
                        onClick={() => setShowForm(!showForm)}
                        className="bg-amber-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-amber-700 transition"
                      >
                        <PlusIcon />
                        {showForm ? 'Cancelar' : 'Agregar'}
                      </button>
                      <button
                        onClick={downloadData}
                        className="bg-green-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-green-700 transition"
                      >
                        <DownloadIcon />
                        Exportar
                      </button>
                    </div>
                  </div>

                  {showForm && (
                    <div className="mb-6 bg-amber-50 p-4 rounded-lg">
                      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                        <input
                          type="text"
                          name="nombre"
                          value={formData.nombre}
                          onChange={handleInputChange}
                          placeholder="Nombre *"
                          className="border border-amber-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500"
                        />
                        <input
                          type="text"
                          name="tipo"
                          value={formData.tipo}
                          onChange={handleInputChange}
                          placeholder="Tipo (IPA, Lager, Stout...) *"
                          className="border border-amber-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500"
                        />
                        <input
                          type="text"
                          name="nacionalidad"
                          value={formData.nacionalidad}
                          onChange={handleInputChange}
                          placeholder="Nacionalidad *"
                          className="border border-amber-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500"
                        />
                        <input
                          type="text"
                          name="color"
                          value={formData.color}
                          onChange={handleInputChange}
                          placeholder="Color (Rubia, Negra, Tostada...) *"
                          className="border border-amber-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500"
                        />
                        <input
                          type="number"
                          name="puntuacion"
                          value={formData.puntuacion}
                          onChange={handleInputChange}
                          placeholder="Puntuaci√≥n (1-10) *"
                          min="1"
                          max="10"
                          step="0.1"
                          className="border border-amber-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-amber-500"
                        />
                        <div className="flex items-center gap-2">
                          <label className="cursor-pointer bg-amber-200 px-4 py-2 rounded hover:bg-amber-300 flex items-center gap-2 transition">
                            üì∑ Subir Foto
                            <input
                              type="file"
                              accept="image/*"
                              onChange={handleImageChange}
                              className="hidden"
                            />
                          </label>
                          {formData.imagen && <span className="text-sm text-green-600 font-semibold">‚úì Foto cargada</span>}
                        </div>
                      </div>
                      <textarea
                        name="observaciones"
                        value={formData.observaciones}
                        onChange={handleInputChange}
                        placeholder="Observaciones"
                        className="border border-amber-300 rounded px-3 py-2 w-full mb-4 focus:outline-none focus:ring-2 focus:ring-amber-500"
                        rows="3"
                      />
                      <button
                        onClick={handleSubmit}
                        className="bg-amber-700 text-white px-6 py-2 rounded-lg hover:bg-amber-800 transition font-semibold"
                      >
                        {editingId ? 'Actualizar' : 'Guardar'} Cerveza
                      </button>
                    </div>
                  )}

                  <div className="mb-6">
                    <h2 className="text-xl font-bold text-amber-800 mb-2">üîç Buscador SQL</h2>
                    <div className="flex gap-2 flex-wrap">
                      <input
                        type="text"
                        value={sqlQuery}
                        onChange={(e) => setSqlQuery(e.target.value)}
                        placeholder="WHERE tipo LIKE '%IPA%' ORDER BY puntuacion DESC"
                        className="flex-1 min-w-[200px] border border-amber-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500"
                        onKeyPress={(e) => e.key === 'Enter' && executeSQLQuery()}
                      />
                      <button
                        onClick={executeSQLQuery}
                        className="bg-blue-600 text-white px-4 py-2 rounded-lg flex items-center gap-2 hover:bg-blue-700 transition"
                      >
                        <SearchIcon />
                        Buscar
                      </button>
                    </div>
                    <p className="text-sm text-gray-600 mt-2">
                      Ejemplos: <code className="bg-gray-100 px-1 rounded">WHERE tipo = "IPA"</code> | <code className="bg-gray-100 px-1 rounded">WHERE puntuacion &gt; 8</code> | <code className="bg-gray-100 px-1 rounded">WHERE nacionalidad LIKE "%Espa√±a%" ORDER BY puntuacion DESC</code>
                    </p>
                  </div>
                </div>

                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                  {filteredBeers.map(beer => (
                    <div key={beer.id} className="bg-white rounded-lg shadow-md p-4 hover:shadow-xl transition-shadow">
                      {beer.imagen && (
                        <img src={beer.imagen} alt={beer.nombre} className="w-full h-48 object-contain mb-3 rounded bg-gray-50" />
                      )}
                      <h3 className="text-xl font-bold text-amber-800 mb-2">{beer.nombre}</h3>
                      <div className="space-y-1 text-sm mb-3">
                        <p><span className="font-semibold text-amber-700">Tipo:</span> {beer.tipo}</p>
                        <p><span className="font-semibold text-amber-700">Nacionalidad:</span> {beer.nacionalidad}</p>
                        <p><span className="font-semibold text-amber-700">Color:</span> {beer.color}</p>
                        <p><span className="font-semibold text-amber-700">Puntuaci√≥n:</span> <span className="text-lg">‚≠ê {beer.puntuacion}/10</span></p>
                        {beer.observaciones && (
                          <p className="text-gray-600 italic mt-2 pt-2 border-t border-gray-200">"{beer.observaciones}"</p>
                        )}
                      </div>
                      <div className="flex gap-2 mt-3">
                        <button
                          onClick={() => handleEdit(beer)}
                          className="flex-1 bg-blue-500 text-white px-3 py-2 rounded flex items-center justify-center gap-1 hover:bg-blue-600 transition"
                        >
                          <EditIcon />
                          Editar
                        </button>
                        <button
                          onClick={() => handleDelete(beer.id)}
                          className="flex-1 bg-red-500 text-white px-3 py-2 rounded flex items-center justify-center gap-1 hover:bg-red-600 transition"
                        >
                          <TrashIcon />
                          Eliminar
                        </button>
                      </div>
                    </div>
                  ))}
                </div>

                {filteredBeers.length === 0 && (
                  <div className="text-center py-16 text-gray-500">
                    <div className="text-6xl mb-4">üç∫</div>
                    <p className="text-xl font-semibold mb-2">
                      {beers.length === 0 
                        ? "Tu colecci√≥n est√° vac√≠a"
                        : "No se encontraron resultados"}
                    </p>
                    <p className="text-sm">
                      {beers.length === 0 
                        ? "¬°Agrega tu primera cerveza para comenzar!"
                        : "Intenta con otra b√∫squeda SQL"}
                    </p>
                  </div>
                )}
              </div>
            </div>
          );
        }

        // Renderizar la aplicaci√≥n
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BeerDatabase />);
    </script>
</body>
</html>
