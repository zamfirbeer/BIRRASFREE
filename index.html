<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cervec√©ame pero con moderaci√≥n</title>

  <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Firebase UMD (compat) -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
</head>
<body class="bg-amber-50">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyA8HtouyDiMEr7wYgIVjP-tNog9QAp5tZU",
      authDomain: "beerfree-e7dbb.firebaseapp.com",
      projectId: "beerfree-e7dbb",
      storageBucket: "beerfree-e7dbb.firebasestorage.app",
      messagingSenderId: "990167849390",
      appId: "1:990167849390:web:d0dc8fb5d263d07273503f"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Iconos
    const PlusIcon = () => <span>‚ûï</span>;
    const SearchIcon = () => <span>üîç</span>;
    const DownloadIcon = () => <span>üíæ</span>;
    const EditIcon = () => <span>‚úèÔ∏è</span>;
    const TrashIcon = () => <span>üóëÔ∏è</span>;

    function BeerDatabase() {
      const [beers, setBeers] = useState([]);
      const [filteredBeers, setFilteredBeers] = useState([]);
      const [showForm, setShowForm] = useState(false);
      const [editingId, setEditingId] = useState(null);
      const [sqlQuery, setSqlQuery] = useState('');

      const [orderField, setOrderField] = useState('');
      const [orderDirection, setOrderDirection] = useState('asc');

      const [formData, setFormData] = useState({
        nombre: '',
        tipo: '',
        nacionalidad: '',
        color: '',
        observaciones: '',
        puntuacion: '',
        imagen: ''
      });

      // Cargar cervezas
      const loadBeers = () => {
        db.collection('beers').get().then(snapshot => {
          const data = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
          setBeers(data);
          setFilteredBeers(applyOrdering(data));
        });
      };

      useEffect(() => { loadBeers(); }, []);

      // Ordenaci√≥n
      const applyOrdering = (data) => {
        if (!orderField) return data;

        return [...data].sort((a, b) => {
          const aVal = a[orderField] ?? '';
          const bVal = b[orderField] ?? '';

          if (!isNaN(aVal) && !isNaN(bVal)) {
            return orderDirection === 'desc' ? bVal - aVal : aVal - bVal;
          }

          return orderDirection === 'desc'
            ? bVal.toString().localeCompare(aVal.toString())
            : aVal.toString().localeCompare(bVal.toString());
        });
      };

      // Inputs
      const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: name === 'puntuacion' ? Number(value) : value }));
      };

      const handleImageChange = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onloadend = () => setFormData(prev => ({ ...prev, imagen: reader.result }));
          reader.readAsDataURL(file);
        }
      };

      // Guardar / editar
      const handleSubmit = () => {
        if (!formData.nombre || !formData.tipo || !formData.nacionalidad || !formData.color || !formData.puntuacion) {
          alert('Completa todos los campos obligatorios');
          return;
        }

        if (editingId) {
          db.collection('beers').doc(editingId).update(formData).then(() => {
            resetForm();
            loadBeers();
          });
        } else {
          db.collection('beers').add(formData).then(() => {
            resetForm();
            loadBeers();
          });
        }
      };

      const resetForm = () => {
        setFormData({ nombre:'', tipo:'', nacionalidad:'', color:'', observaciones:'', puntuacion:'', imagen:'' });
        setEditingId(null);
        setShowForm(false);
      };

      const handleEdit = (beer) => {
        const { id, ...data } = beer;
        setFormData({ ...data, puntuacion: Number(data.puntuacion) });
        setEditingId(id);
        setShowForm(true);
      };

      const handleDelete = (id) => {
        if (confirm('¬øEliminar esta cerveza?')) {
          db.collection('beers').doc(id).delete().then(loadBeers);
        }
      };

      // SQL fake
      const executeSQLQuery = () => {
        if (!sqlQuery.trim()) {
          setFilteredBeers(applyOrdering(beers));
          return;
        }

        let result = [...beers];
        const query = sqlQuery.toLowerCase();

        if (query.includes('where')) {
          const whereClause = query.split('where')[1].split('order by')[0].trim();
          const conditions = whereClause.split('and').map(c => c.trim());

          result = result.filter(beer =>
            conditions.every(cond => {
              const like = cond.match(/(\w+)\s+like\s+['"]%(.+)%['"]/i);
              const eq = cond.match(/(\w+)\s*=\s*['"](.+)['"]/i);
              const gt = cond.match(/(\w+)\s*>\s*(\d+)/i);
              const lt = cond.match(/(\w+)\s*<\s*(\d+)/i);

              if (like) return beer[like[1]]?.toLowerCase().includes(like[2]);
              if (eq) return beer[eq[1]]?.toLowerCase() === eq[2];
              if (gt) return Number(beer[gt[1]]) > Number(gt[2]);
              if (lt) return Number(beer[lt[1]]) < Number(lt[2]);
              return true;
            })
          );
        }

        setFilteredBeers(applyOrdering(result));
      };

      const downloadData = () => {
        const blob = new Blob([JSON.stringify(beers, null, 2)], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'mis_cervezas.json';
        a.click();
      };

      return (
        <div className="min-h-screen p-4 max-w-7xl mx-auto">
          <h1 className="text-3xl font-bold text-amber-800 mb-6">üç∫ Cervec√©ame pero con moderaci√≥n</h1>

          <div className="flex gap-2 mb-6 flex-wrap">
            <button onClick={() => setShowForm(!showForm)} className="bg-amber-600 text-white px-4 py-2 rounded"> <PlusIcon /> Agregar </button>
            <button onClick={downloadData} className="bg-green-600 text-white px-4 py-2 rounded"> <DownloadIcon /> Exportar </button>
          </div>

          <div className="bg-white p-4 rounded shadow mb-6 flex gap-4 flex-wrap">
            <select value={orderField} onChange={e => setOrderField(e.target.value)} className="border px-3 py-2 rounded">
              <option value="">-- Ordenar por --</option>
              <option value="nombre">Nombre</option>
              <option value="tipo">Tipo</option>
              <option value="nacionalidad">Nacionalidad</option>
              <option value="color">Color</option>
              <option value="puntuacion">Puntuaci√≥n</option>
            </select>

            <select value={orderDirection} onChange={e => setOrderDirection(e.target.value)} className="border px-3 py-2 rounded" disabled={!orderField}>
              <option value="asc">Ascendente</option>
              <option value="desc">Descendente</option>
            </select>

            <button onClick={() => setFilteredBeers(applyOrdering(filteredBeers))} className="bg-amber-600 text-white px-4 py-2 rounded">Aplicar orden</button>
          </div>

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {filteredBeers.map(b => (
              <div key={b.id} className="bg-white p-4 rounded shadow">
                {b.imagen && <img src={b.imagen} className="h-40 w-full object-contain mb-2" />}
                <h3 className="font-bold text-xl">{b.nombre}</h3>
                <p>Tipo: {b.tipo}</p>
                <p>Nacionalidad: {b.nacionalidad}</p>
                <p>Color: {b.color}</p>
                <p>Puntuaci√≥n: ‚≠ê {b.puntuacion}</p>
                <div className="flex gap-2 mt-3">
                  <button onClick={() => handleEdit(b)} className="bg-blue-500 text-white px-3 py-1 rounded"><EditIcon /></button>
                  <button onClick={() => handleDelete(b.id)} className="bg-red-500 text-white px-3 py-1 rounded"><TrashIcon /></button>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<BeerDatabase />);
  </script>
</body>
</html>




