<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi Colecci贸n de Cervezas</title>
  <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-amber-50">
  <div id="root"></div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      getDocs,
      addDoc,
      deleteDoc,
      doc,
      updateDoc
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // Config Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyA8HtouyDiMEr7wYgIVjP-tNog9QAp5tZU",
      authDomain: "beerfree-e7dbb.firebaseapp.com",
      projectId: "beerfree-e7dbb",
      storageBucket: "beerfree-e7dbb.firebasestorage.app",
      messagingSenderId: "990167849390",
      appId: "1:990167849390:web:d0dc8fb5d263d07273503f"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const fb = { collection, getDocs, addDoc, deleteDoc, doc, updateDoc };

    // Iconos SVG
    const PlusIcon = () => (
      <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
        <line x1="12" y1="5" x2="12" y2="19"></line>
        <line x1="5" y1="12" x2="19" y2="12"></line>
      </svg>
    );

    const BeerDatabase = () => {
      const { useState, useEffect } = React;

      const [beers, setBeers] = useState([]);
      const [showForm, setShowForm] = useState(false);
      const [editingId, setEditingId] = useState(null);
      const [formData, setFormData] = useState({
        nombre: '', tipo: '', nacionalidad: '', color: '',
        observaciones: '', puntuacion: '', imagen: ''
      });

      useEffect(() => {
        async function loadBeers() {
          const snapshot = await fb.getDocs(collection(db, "beers"));
          setBeers(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));
        }
        loadBeers();
      }, []);

      const handleInputChange = (e) => {
        const { name, value } = e.target;
        setFormData(prev => ({ ...prev, [name]: value }));
      };

      const handleImageChange = (e) => {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onloadend = () => setFormData(prev => ({ ...prev, imagen: reader.result }));
          reader.readAsDataURL(file);
        }
      };

      const handleSubmit = async () => {
        if (!formData.nombre || !formData.tipo || !formData.nacionalidad || !formData.color || !formData.puntuacion) {
          alert("Completa todos los campos obligatorios");
          return;
        }

        if (editingId) {
          await fb.updateDoc(doc(db, "beers", editingId), formData);
          setEditingId(null);
        } else {
          await fb.addDoc(collection(db, "beers"), formData);
        }

        const snapshot = await fb.getDocs(collection(db, "beers"));
        setBeers(snapshot.docs.map(d => ({ id: d.id, ...d.data() })));
        setFormData({ nombre:'', tipo:'', nacionalidad:'', color:'', observaciones:'', puntuacion:'', imagen:'' });
        setShowForm(false);
      };

      const handleEdit = (beer) => {
        setFormData({ ...beer });
        setEditingId(beer.id);
        setShowForm(true);
      };

      const handleDelete = async (id) => {
        if (!confirm("驴Eliminar esta cerveza?")) return;
        await fb.deleteDoc(doc(db, "beers", id));
        setBeers(beers.filter(b => b.id !== id));
      };

      return (
        <div className="max-w-7xl mx-auto p-4">
          <div className="flex justify-between items-center mb-6">
            <h1 className="text-3xl font-bold text-amber-800"> Mi Colecci贸n de Cervezas</h1>
            <button onClick={() => setShowForm(!showForm)} className="bg-amber-600 text-white px-4 py-2 rounded flex items-center gap-2">
              <PlusIcon /> {showForm ? "Cancelar" : "Agregar"}
            </button>
          </div>

          {showForm && (
            <div className="mb-6 bg-amber-50 p-4 rounded shadow">
              <input type="text" name="nombre" value={formData.nombre} onChange={handleInputChange} placeholder="Nombre *" className="border p-2 mb-2 w-full" />
              <input type="text" name="tipo" value={formData.tipo} onChange={handleInputChange} placeholder="Tipo *" className="border p-2 mb-2 w-full" />
              <input type="text" name="nacionalidad" value={formData.nacionalidad} onChange={handleInputChange} placeholder="Nacionalidad *" className="border p-2 mb-2 w-full" />
              <input type="text" name="color" value={formData.color} onChange={handleInputChange} placeholder="Color *" className="border p-2 mb-2 w-full" />
              <input type="number" name="puntuacion" value={formData.puntuacion} onChange={handleInputChange} placeholder="Puntuaci贸n *" className="border p-2 mb-2 w-full" />
              <input type="file" onChange={handleImageChange} className="mb-2" />
              <button onClick={handleSubmit} className="bg-amber-700 text-white px-4 py-2 rounded">{editingId ? "Actualizar" : "Guardar"}</button>
            </div>
          )}

          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {beers.map(beer => (
              <div key={beer.id} className="bg-white p-4 rounded shadow">
                {beer.imagen && <img src={beer.imagen} alt={beer.nombre} className="w-full h-48 object-contain mb-2" />}
                <h3 className="text-xl font-bold">{beer.nombre}</h3>
                <p>Tipo: {beer.tipo}</p>
                <p>Nacionalidad: {beer.nacionalidad}</p>
                <p>Color: {beer.color}</p>
                <p>Puntuaci贸n: {beer.puntuacion}</p>
                <div className="flex gap-2 mt-2">
                  <button onClick={() => handleEdit(beer)} className="bg-blue-500 text-white px-2 py-1 rounded">Editar</button>
                  <button onClick={() => handleDelete(beer.id)} className="bg-red-500 text-white px-2 py-1 rounded">Eliminar</button>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<BeerDatabase />);
  </script>
</body>
</html>
